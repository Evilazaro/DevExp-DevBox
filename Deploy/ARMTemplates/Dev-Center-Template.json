{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "imageTemplates_Back_End_Containers_name": {
            "defaultValue": "Back-End-Containers",
            "type": "String"
        },
        "galleries_ContosoImageGallery_externalid": {
            "defaultValue": "/subscriptions/9e946e16-45cd-4e6a-ad69-bb7c5e24c230/resourceGroups/Contoso-Base-Images-Engineers-rg/providers/Microsoft.Compute/galleries/ContosoImageGallery",
            "type": "String"
        },
        "userAssignedIdentities_contosoIdentityIBuilderUserDevBox_externalid": {
            "defaultValue": "/subscriptions/9e946e16-45cd-4e6a-ad69-bb7c5e24c230/resourceGroups/Contoso-Base-Images-Engineers-rg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contosoIdentityIBuilderUserDevBox",
            "type": "String"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.VirtualMachineImages/imageTemplates",
            "apiVersion": "2022-07-01",
            "name": "[parameters('imageTemplates_Back_End_Containers_name')]",
            "location": "westus3",
            "identity": {
                "type": "UserAssigned",
                "userAssignedIdentities": {
                    "/subscriptions/9e946e16-45cd-4e6a-ad69-bb7c5e24c230/resourceGroups/Contoso-Base-Images-Engineers-rg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/contosoIdentityIBuilderUserDevBox": {}
                }
            },
            "properties": {
                "source": {
                    "offer": "visualstudioplustools",
                    "publisher": "microsoftvisualstudio",
                    "sku": "vs-2022-ent-general-win11-m365-gen2",
                    "type": "PlatformImage",
                    "version": "latest"
                },
                "distribute": [
                    {
                        "artifactTags": {},
                        "excludeFromLatest": false,
                        "galleryImageId": "[concat(parameters('galleries_ContosoImageGallery_externalid'), concat('/images/', parameters('imageTemplates_Back_End_Containers_name')))]",
                        "replicationRegions": [
                            "westus3"
                        ],
                        "runOutputName": "runOutputImageVersion",
                        "type": "SharedImage"
                    }
                ],
                "buildTimeoutInMinutes": 0,
                "vmProfile": {
                    "vmSize": "Standard_D8s_v3",
                    "osDiskSizeGB": 128,
                    "userAssignedIdentities": [
                        "[parameters('userAssignedIdentities_contosoIdentityIBuilderUserDevBox_externalid')]"
                    ]
                }
            }
        }
    ]
}