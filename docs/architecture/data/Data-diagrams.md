# Data Architecture Mermaid Diagrams

<!--
  Generated by: BDAT-DocGen Orchestrator v2.1 (DIAG-GEN Sub-Prompt)
  Layer: Data
  Generated: 2026-01-30T00:00:00Z
  Mermaid Version: 10.x Compatible
-->

## Document Metadata

| Field               | Value      |
| ------------------- | ---------- |
| **Layer**           | Data       |
| **Layer Code**      | D          |
| **Generated**       | 2026-01-30 |
| **Diagram Count**   | 8          |
| **Mermaid Version** | 10.x       |

---

## 1. Entity Relationship Diagrams

### 1.1 Core Data Entity Model

**Purpose:** Visualize the primary data entities and their relationships within
the DevExp-DevBox configuration model.

**Best Practices:**

- Use meaningful entity names in PascalCase
- Define primary keys (PK) and foreign keys (FK) explicitly
- Group related attributes logically
- Include cardinality indicators for all relationships

```mermaid
erDiagram
    DevCenter ||--o{ Project : contains
    DevCenter ||--o{ Catalog : "has (DevCenter-level)"
    DevCenter ||--o{ EnvironmentType : "defines (DevCenter-level)"
    DevCenter ||--|| DevCenterIdentity : uses

    Project ||--o{ Pool : has
    Project ||--o{ Catalog : "has (Project-level)"
    Project ||--o{ EnvironmentType : "inherits/overrides"
    Project ||--o| Network : configures
    Project ||--|| ProjectIdentity : uses

    Pool ||--|| ImageDefinition : references

    Catalog }|--|| GitRepository : "syncs from"

    DevCenter {
        string name PK "Unique Dev Center name"
        enum catalogItemSyncEnableStatus "Enabled|Disabled"
        enum microsoftHostedNetworkEnableStatus "Enabled|Disabled"
        enum installAzureMonitorAgentEnableStatus "Enabled|Disabled"
        object identity FK "DevCenterIdentity reference"
        array catalogs "Catalog references"
        array environmentTypes "EnvironmentType references"
        array projects FK "Project references"
        object tags "Azure resource tags"
    }

    Project {
        string name PK "Unique project name"
        string description "Project description"
        object network FK "Network configuration"
        object identity FK "ProjectIdentity reference"
        array pools FK "Pool references"
        array catalogs FK "Catalog references"
        array environmentTypes FK "EnvironmentType references"
        object tags "Azure resource tags"
    }

    Pool {
        string name PK "Pool identifier"
        string imageDefinitionName FK "Image definition reference"
        string vmSku "Azure VM SKU"
    }

    Catalog {
        string name PK "Catalog identifier"
        enum type "gitHub|adoGit|environmentDefinition|imageDefinition"
        enum visibility "public|private"
        string uri "Git repository URI"
        string branch "Git branch"
        string path "Path within repository"
        enum sourceControl "gitHub|adoGit"
    }

    EnvironmentType {
        string name PK "Environment name"
        string deploymentTargetId "Target subscription ID"
    }

    Network {
        string name PK "VNet name"
        boolean create "Create new or use existing"
        string resourceGroupName "Network RG name"
        enum virtualNetworkType "Managed|Unmanaged"
        array addressPrefixes "CIDR blocks"
        array subnets FK "Subnet references"
        object tags "Resource tags"
    }

    DevCenterIdentity {
        enum type PK "SystemAssigned|UserAssigned|None"
        array devCenterRoles "RBAC role assignments"
        array orgRoleTypes "Organization role assignments"
    }

    ProjectIdentity {
        enum type PK "SystemAssigned|UserAssigned|None"
        array roleAssignments "Group role assignments"
    }

    ImageDefinition {
        string name PK "Image definition name"
    }

    GitRepository {
        string uri PK "Repository URI"
        string branch "Branch name"
    }
```

**Components Depicted:** DevCenter, Project, Pool, Catalog, EnvironmentType,
Network, Identity  
**Source:** infra/settings/workload/devcenter.schema.json

---

### 1.2 Security Data Model

**Purpose:** Visualize the security configuration entities and their
relationships.

**Best Practices:**

- Highlight security-sensitive attributes
- Show encryption and protection settings
- Include access control relationships

```mermaid
erDiagram
    SecurityConfig ||--|| KeyVault : manages
    KeyVault ||--o{ Secret : stores
    KeyVault }|--|| RBACPolicy : "protected by"

    ResourceOrganization ||--|| SecurityRG : defines
    SecurityRG ||--|| KeyVault : contains

    SecurityConfig {
        boolean create "Create new Key Vault"
        object keyVault FK "KeyVault configuration"
    }

    KeyVault {
        string name PK "Globally unique name (3-24 chars)"
        string description "Purpose description"
        boolean enablePurgeProtection "Prevent permanent deletion"
        boolean enableSoftDelete "Enable recovery"
        integer softDeleteRetentionInDays "Retention period (7-90)"
        boolean enableRbacAuthorization "Use RBAC for auth"
        object tags "Resource tags"
    }

    Secret {
        string name PK "Secret name"
        string value "Secret value (encrypted)"
        string contentType "Secret type"
    }

    RBACPolicy {
        string principalId PK "Azure AD principal"
        string roleDefinitionId FK "RBAC role"
        string scope "Assignment scope"
    }

    SecurityRG {
        string name PK "Resource group name"
        string description "RG description"
        object tags "Resource tags"
    }
```

**Components Depicted:** SecurityConfig, KeyVault, Secret, RBACPolicy  
**Source:** infra/settings/security/security.schema.json

---

### 1.3 Resource Organization Model

**Purpose:** Visualize the Azure resource group organization structure.

```mermaid
erDiagram
    ResourceOrganization ||--|| WorkloadRG : defines
    ResourceOrganization ||--|| SecurityRG : defines
    ResourceOrganization ||--|| MonitoringRG : defines

    WorkloadRG ||--|| DevCenter : contains
    WorkloadRG ||--o{ Project : contains
    SecurityRG ||--|| KeyVault : contains
    MonitoringRG ||--|| LogAnalytics : contains

    ResourceOrganization {
        object workload FK "Workload RG config"
        object security FK "Security RG config"
        object monitoring FK "Monitoring RG config"
    }

    WorkloadRG {
        boolean create "Create new or use existing"
        string name PK "Resource group name"
        string description "RG description"
        object tags "Resource tags"
    }

    SecurityRG {
        boolean create "Create new or use existing"
        string name PK "Resource group name"
        string description "RG description"
        object tags "Resource tags"
    }

    MonitoringRG {
        boolean create "Create new or use existing"
        string name PK "Resource group name"
        string description "RG description"
        object tags "Resource tags"
    }

    DevCenter {
        string name PK "Dev Center name"
    }

    KeyVault {
        string name PK "Key Vault name"
    }

    LogAnalytics {
        string name PK "Workspace name"
    }
```

**Components Depicted:** ResourceOrganization, WorkloadRG, SecurityRG,
MonitoringRG  
**Source:** infra/settings/resourceOrganization/azureResources.schema.json

---

## 2. Data Flow Diagrams

### 2.1 Configuration Data Flow

**Purpose:** Illustrate how configuration data flows from YAML files through
validation to Azure deployment.

**Best Practices:**

- Show data transformation points
- Indicate validation checkpoints
- Use clear directional flow

```mermaid
flowchart LR
    subgraph Sources["Configuration Sources"]
        YAML1["devcenter.yaml"]
        YAML2["security.yaml"]
        YAML3["azureResources.yaml"]
    end

    subgraph Schemas["Schema Validation"]
        SCHEMA1["devcenter.schema.json"]
        SCHEMA2["security.schema.json"]
        SCHEMA3["azureResources.schema.json"]
    end

    subgraph Validation["Validation Points"]
        IDE["IDE IntelliSense<br/>Design-time"]
        CICD["CI Pipeline<br/>Build-time"]
    end

    subgraph Processing["Bicep Processing"]
        LOAD["loadYamlContent()"]
        MAIN["main.bicep"]
        MODULES["Bicep Modules"]
    end

    subgraph Deployment["Azure Deployment"]
        ARM["ARM Template"]
        AZURE["Azure Resources"]
    end

    YAML1 -.->|"$schema"| SCHEMA1
    YAML2 -.->|"$schema"| SCHEMA2
    YAML3 -.->|"$schema"| SCHEMA3

    SCHEMA1 --> IDE
    SCHEMA2 --> IDE
    SCHEMA3 --> IDE

    IDE --> CICD

    YAML1 --> LOAD
    YAML2 --> LOAD
    YAML3 --> LOAD

    LOAD --> MAIN
    MAIN --> MODULES
    MODULES --> ARM
    ARM --> AZURE
```

**Data Transformations:**

1. YAML → JSON (implicit by loadYamlContent)
2. JSON → Bicep Parameters
3. Bicep → ARM Template
4. ARM → Azure API Calls

**Source:** infra/main.bicep:L34

---

### 2.2 Secrets Data Flow

**Purpose:** Illustrate the secure flow of secrets from input to consumption.

```mermaid
flowchart TD
    subgraph Input["Secret Input"]
        USER["User/CI Pipeline"]
        ENV["Environment Variable"]
        PARAM["Bicep Parameter<br/>(secure)"]
    end

    subgraph Storage["Secure Storage"]
        KV["Azure Key Vault"]
        SECRET["Secret Object"]
        REF["Secret Reference URI"]
    end

    subgraph Consumer["Secret Consumer"]
        DC["Dev Center"]
        MI["Managed Identity"]
        CATALOG["Catalog Authentication"]
    end

    subgraph External["External Systems"]
        GH["GitHub API"]
        ADO["Azure DevOps API"]
    end

    USER -->|"azd up"| ENV
    ENV -->|"--parameter"| PARAM
    PARAM -->|"Store"| KV
    KV --> SECRET
    SECRET --> REF

    REF -->|"Configure"| DC
    DC -->|"Authenticate as"| MI
    MI -->|"Retrieve secret"| KV
    KV -->|"Return value"| MI
    MI --> CATALOG

    CATALOG -->|"PAT Auth"| GH
    CATALOG -->|"Token Auth"| ADO
```

**Security Controls:**

- Parameter marked `@secure()` in Bicep
- Key Vault RBAC authorization
- Managed Identity for secret retrieval
- No secret values in logs or state

**Source:** infra/main.bicep:L24-L25, infra/security/keyVault.bicep

---

### 2.3 Schema Validation Flow

**Purpose:** Detail the multi-stage validation process for configuration data.

```mermaid
flowchart TB
    subgraph Stage1["Stage 1: Design Time"]
        AUTHOR["Developer Authors YAML"]
        YLS["yaml-language-server"]
        INTELLISENSE["IntelliSense Feedback"]
        ERRORS1["Immediate Error Highlighting"]
    end

    subgraph Stage2["Stage 2: Commit Time"]
        COMMIT["Git Commit"]
        HOOK["Pre-commit Hook<br/>(optional)"]
        LINT["YAML Lint"]
    end

    subgraph Stage3["Stage 3: Build Time"]
        PR["Pull Request"]
        CI["CI Pipeline"]
        VALIDATE["Schema Validation Action"]
        ERRORS2["Build Failure on Invalid"]
    end

    subgraph Stage4["Stage 4: Deploy Time"]
        BICEP["Bicep Compilation"]
        ARM["ARM Validation"]
        WHATIF["What-If Preview"]
        DEPLOY["Azure Deployment"]
    end

    AUTHOR --> YLS
    YLS --> INTELLISENSE
    YLS --> ERRORS1

    AUTHOR --> COMMIT
    COMMIT --> HOOK
    HOOK --> LINT

    COMMIT --> PR
    PR --> CI
    CI --> VALIDATE
    VALIDATE -->|"Invalid"| ERRORS2
    VALIDATE -->|"Valid"| BICEP

    BICEP --> ARM
    ARM --> WHATIF
    WHATIF --> DEPLOY
```

**Validation Checkpoints:** | Stage | Tool | Error Handling |
|-------|------|----------------| | Design | yaml-language-server | Real-time
feedback | | Build | CI Pipeline | Block merge | | Deploy | ARM API | Deployment
failure |

---

## 3. State Diagrams

### 3.1 Configuration Lifecycle

**Purpose:** Model the states of configuration data through its lifecycle.

```mermaid
stateDiagram-v2
    [*] --> Draft: Create config file

    Draft --> Validating: Save file
    Validating --> Draft: Validation errors
    Validating --> Valid: Schema passes

    Valid --> Committed: git commit
    Committed --> InReview: Create PR

    InReview --> Committed: Review rejected
    InReview --> Approved: Review approved

    Approved --> Deploying: Merge to main
    Deploying --> Deployed: Deployment success
    Deploying --> Failed: Deployment error

    Failed --> Draft: Fix and retry
    Deployed --> [*]: Configuration active

    Deployed --> Draft: Update required

    state Validating {
        [*] --> SchemaCheck
        SchemaCheck --> TypeCheck: Schema valid
        TypeCheck --> RefCheck: Types valid
        RefCheck --> [*]: References valid
    }

    state Deploying {
        [*] --> WhatIf
        WhatIf --> ARMValidate: Preview OK
        ARMValidate --> ResourceCreate: ARM valid
        ResourceCreate --> [*]: Resources created
    }
```

---

### 3.2 Secret Lifecycle

**Purpose:** Model the lifecycle states of secrets in Key Vault.

```mermaid
stateDiagram-v2
    [*] --> Created: Store secret

    Created --> Active: Enable secret
    Active --> Accessed: Retrieve secret
    Accessed --> Active: Access complete

    Active --> Rotating: Rotation triggered
    Rotating --> Active: New version active

    Active --> Disabled: Disable secret
    Disabled --> Active: Re-enable
    Disabled --> Deleted: Delete secret

    Active --> Deleted: Delete secret

    Deleted --> Recovering: Recover (soft delete)
    Recovering --> Active: Recovery complete

    Deleted --> Purged: Purge (if allowed)
    Purged --> [*]: Permanently removed

    note right of Deleted
        Soft delete retention:
        7-90 days (configurable)
    end note

    note right of Purged
        Only if purge protection
        is disabled
    end note
```

---

## 4. Hierarchical Diagrams

### 4.1 Data Entity Hierarchy

**Purpose:** Visualize the hierarchical nesting of data entities.

```mermaid
flowchart TB
    subgraph Root["Root Configuration"]
        DC["DevCenter<br/>devexp-devcenter"]
    end

    subgraph DCLevel["Dev Center Level"]
        DCI["Identity<br/>SystemAssigned"]
        DCC["Catalogs<br/>customTasks"]
        DCE["Environment Types<br/>dev, staging, UAT"]
    end

    subgraph Projects["Projects"]
        P1["Project: eShop"]
    end

    subgraph P1Config["eShop Configuration"]
        P1I["Identity<br/>SystemAssigned"]
        P1N["Network<br/>eShop VNet<br/>10.0.0.0/16"]
        P1POOLS["Pools"]
        P1CATS["Catalogs"]
        P1ENV["Environment Types"]
    end

    subgraph Pools["Pool Details"]
        POOL1["backend-engineer<br/>32c/128GB/512SSD"]
        POOL2["frontend-engineer<br/>16c/64GB/256SSD"]
    end

    subgraph Catalogs["Catalog Details"]
        CAT1["environments<br/>/.devcenter/environments"]
        CAT2["devboxImages<br/>/.devcenter/imageDefinitions"]
    end

    DC --> DCI
    DC --> DCC
    DC --> DCE
    DC --> P1

    P1 --> P1I
    P1 --> P1N
    P1 --> P1POOLS
    P1 --> P1CATS
    P1 --> P1ENV

    P1POOLS --> POOL1
    P1POOLS --> POOL2

    P1CATS --> CAT1
    P1CATS --> CAT2
```

**Source:** infra/settings/workload/devcenter.yaml

---

### 4.2 Schema Definition Hierarchy

**Purpose:** Visualize JSON Schema composition using `$defs`.

```mermaid
flowchart TB
    subgraph DevCenterSchema["devcenter.schema.json"]
        ROOT["Root Schema"]

        subgraph Defs["$defs (Reusable Types)"]
            GUID["guid<br/>GUID pattern"]
            ENABLED["enabledStatus<br/>Enabled|Disabled"]
            TAGS["tags<br/>Resource tags"]
            ROLE["roleAssignment<br/>RBAC config"]
            RBAC["rbacRole<br/>Role definition"]
            CATALOG["catalog<br/>Catalog config"]
            ENVTYPE["environmentType<br/>Environment config"]
            CIDR["cidrBlock<br/>CIDR pattern"]
            SUBNET["subnet<br/>Subnet config"]
            NETWORK["network<br/>Network config"]
            POOL["pool<br/>Pool config"]
            PROJID["projectIdentity<br/>Project identity"]
            PROJECT["project<br/>Project config"]
            DCID["devCenterIdentity<br/>DC identity"]
        end

        subgraph Props["Properties"]
            NAME["name"]
            SYNC["catalogItemSyncEnableStatus"]
            HOSTED["microsoftHostedNetworkEnableStatus"]
            MONITOR["installAzureMonitorAgentEnableStatus"]
            IDENTITY["identity"]
            CATS["catalogs"]
            ENVS["environmentTypes"]
            PROJS["projects"]
            PTAGS["tags"]
        end
    end

    ROOT --> Defs
    ROOT --> Props

    IDENTITY -->|"$ref"| DCID
    CATS -->|"items $ref"| CATALOG
    ENVS -->|"items $ref"| ENVTYPE
    PROJS -->|"items $ref"| PROJECT
    PTAGS -->|"$ref"| TAGS

    PROJECT -->|"$ref"| NETWORK
    PROJECT -->|"$ref"| PROJID
    PROJECT -->|"$ref"| POOL
    PROJECT -->|"$ref"| CATALOG
    PROJECT -->|"$ref"| ENVTYPE

    NETWORK -->|"$ref"| CIDR
    NETWORK -->|"$ref"| SUBNET
    NETWORK -->|"$ref"| TAGS

    DCID -->|"$ref"| ROLE
    DCID -->|"$ref"| RBAC

    PROJID -->|"$ref"| GUID
    PROJID -->|"$ref"| RBAC

    ROLE -->|"$ref"| GUID

    SUBNET -->|"$ref"| CIDR
```

**Source:** infra/settings/workload/devcenter.schema.json:L1-L661

---

## 5. Class Diagrams (Schema Structure)

### 5.1 DevCenter Configuration Class

**Purpose:** Visualize the schema structure as a class diagram for technical
reference.

```mermaid
classDiagram
    class DevCenter {
        +String name
        +EnabledStatus catalogItemSyncEnableStatus
        +EnabledStatus microsoftHostedNetworkEnableStatus
        +EnabledStatus installAzureMonitorAgentEnableStatus
        +DevCenterIdentity identity
        +Catalog[] catalogs
        +EnvironmentType[] environmentTypes
        +Project[] projects
        +Tags tags
    }

    class DevCenterIdentity {
        +IdentityType type
        +RoleAssignment[] devCenter
        +OrgRoleType[] orgRoleTypes
    }

    class Project {
        +String name
        +String description
        +Network network
        +ProjectIdentity identity
        +Pool[] pools
        +Catalog[] catalogs
        +EnvironmentType[] environmentTypes
        +Tags tags
    }

    class ProjectIdentity {
        +IdentityType type
        +GroupRoleAssignment[] roleAssignments
    }

    class Catalog {
        +String name
        +CatalogType type
        +Visibility visibility
        +String uri
        +String branch
        +String path
        +SourceControl sourceControl
    }

    class EnvironmentType {
        +String name
        +String deploymentTargetId
    }

    class Network {
        +String name
        +Boolean create
        +String resourceGroupName
        +NetworkType virtualNetworkType
        +String[] addressPrefixes
        +Subnet[] subnets
        +Tags tags
    }

    class Pool {
        +String name
        +String imageDefinitionName
        +String vmSku
    }

    class Subnet {
        +String name
        +SubnetProperties properties
    }

    class Tags {
        +String environment
        +String division
        +String team
        +String project
        +String costCenter
        +String owner
        +String resources
    }

    DevCenter "1" *-- "0..*" Project : contains
    DevCenter "1" *-- "0..*" Catalog : has
    DevCenter "1" *-- "0..*" EnvironmentType : defines
    DevCenter "1" *-- "1" DevCenterIdentity : uses

    Project "1" *-- "0..*" Pool : has
    Project "1" *-- "0..*" Catalog : has
    Project "1" *-- "0..*" EnvironmentType : inherits
    Project "1" *-- "0..1" Network : configures
    Project "1" *-- "1" ProjectIdentity : uses

    Network "1" *-- "0..*" Subnet : contains
```

---

## 6. Gantt/Timeline Diagrams

### 6.1 Configuration Processing Timeline

**Purpose:** Visualize the temporal sequence of configuration processing.

```mermaid
gantt
    title Configuration Data Processing Timeline
    dateFormat HH:mm
    axisFormat %H:%M

    section Design Time
    Author YAML config           :active, design1, 00:00, 10m
    Schema validation (IDE)      :design2, after design1, 1m

    section Build Time
    Git commit                   :build1, after design2, 1m
    CI pipeline trigger          :build2, after build1, 1m
    Schema validation (CI)       :build3, after build2, 2m
    Bicep linting               :build4, after build3, 2m

    section Deploy Time
    loadYamlContent()           :deploy1, after build4, 1m
    Bicep compilation           :deploy2, after deploy1, 2m
    ARM template generation     :deploy3, after deploy2, 1m
    What-If preview             :deploy4, after deploy3, 3m
    Azure deployment            :crit, deploy5, after deploy4, 5m

    section Runtime
    Resource provisioned        :done, runtime1, after deploy5, 1m
```

---

## 7. Mind Maps

### 7.1 Data Architecture Taxonomy

**Purpose:** Provide a conceptual overview of the Data Architecture components.

```mermaid
mindmap
    root((Data<br/>Architecture))
        Configuration
            Schemas
                devcenter.schema.json
                security.schema.json
                azureResources.schema.json
            YAML Files
                devcenter.yaml
                security.yaml
                azureResources.yaml
            Validation
                JSON Schema
                yaml-language-server
                CI Pipeline
        Entities
            DevCenter
                Identity
                Catalogs
                Environment Types
                Projects
            Project
                Network
                Pools
                Catalogs
            Security
                Key Vault
                Secrets
                RBAC
            Organization
                Workload RG
                Security RG
                Monitoring RG
        Data Flows
            Config to Deployment
            Secrets Management
            Schema Validation
        Governance
            Tagging Standards
            Naming Conventions
            Schema Contracts
```

---

## Appendix: Diagram Validation Results

| Diagram ID | Type            | Mermaid Version | Validation Status |
| ---------- | --------------- | --------------- | ----------------- |
| 1.1        | erDiagram       | 10.x            | ✓ PASS            |
| 1.2        | erDiagram       | 10.x            | ✓ PASS            |
| 1.3        | erDiagram       | 10.x            | ✓ PASS            |
| 2.1        | flowchart       | 10.x            | ✓ PASS            |
| 2.2        | flowchart       | 10.x            | ✓ PASS            |
| 2.3        | flowchart       | 10.x            | ✓ PASS            |
| 3.1        | stateDiagram-v2 | 10.x            | ✓ PASS            |
| 3.2        | stateDiagram-v2 | 10.x            | ✓ PASS            |
| 4.1        | flowchart       | 10.x            | ✓ PASS            |
| 4.2        | flowchart       | 10.x            | ✓ PASS            |
| 5.1        | classDiagram    | 10.x            | ✓ PASS            |
| 6.1        | gantt           | 10.x            | ✓ PASS            |
| 7.1        | mindmap         | 10.x            | ✓ PASS            |

---

_Diagrams generated following TOGAF 10 visualization standards and Mermaid 10.x
best practices._
